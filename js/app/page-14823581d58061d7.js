(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7574:function(e,t,a){Promise.resolve().then(a.bind(a,1692))},1692:function(e,t,a){"use strict";a.d(t,{WatermarkTool:function(){return x}});var s=a(7437),l=a(2265),r=a(5725);let n=e=>{let{onUpload:t}=e,[a,n]=(0,l.useState)(!1),i=(0,l.useCallback)(e=>{let a=e.filter(e=>{let t=["image/jpeg","image/png","image/webp","image/gif"].includes(e.type),a=e.size<=20971520;return t&&a});a.length>0&&t(a)},[t]),{getRootProps:c,getInputProps:o}=(0,r.uI)({onDrop:i,accept:{"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/webp":[".webp"],"image/gif":[".gif"]},onDragEnter:()=>n(!0),onDragLeave:()=>n(!1)});return(0,s.jsxs)("div",{...c(),className:"\n        p-8 border-2 border-dashed rounded-lg text-center cursor-pointer\n        transition-colors duration-200\n        ".concat(a?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n      "),children:[(0,s.jsx)("input",{...o()}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-lg",children:"拖拽图片到此处，或点击上传"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["支持 JPG、PNG、WebP、GIF 格式",(0,s.jsx)("br",{}),"单个文件大小不超过 20MB"]})]})]})},i=e=>{let{config:t,onChange:a}=e,l=e=>{a({...t,text:e})},r=e=>{a({...t,fontSize:e})},n=e=>{a({...t,color:e})},i=e=>{a({...t,opacity:e})},c=e=>{a({...t,position:e})},o=e=>{a({...t,angle:e})},d=e=>{a({...t,tiled:e})},m=e=>{a({...t,securityCode:e})};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"水印类型"}),(0,s.jsxs)("select",{value:t.type,onChange:e=>a({...t,type:e.target.value}),className:"w-full rounded-md border border-gray-300 px-3 py-2",children:[(0,s.jsx)("option",{value:"text",children:"文字水印"}),(0,s.jsx)("option",{value:"image",children:"图片水印"}),(0,s.jsx)("option",{value:"pattern",children:"图案水印"}),(0,s.jsx)("option",{value:"security",children:"防伪水印"})]})]}),"text"===t.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"水印文字"}),(0,s.jsx)("input",{type:"text",value:t.text,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"字体大小"}),(0,s.jsx)("input",{type:"number",value:t.fontSize,onChange:e=>r(parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"颜色"}),(0,s.jsx)("input",{type:"color",value:t.color,onChange:e=>n(e.target.value),className:"w-full h-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.enable3D,onChange:e=>a({enable3D:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"启用3D效果"})]})}),t.enable3D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"3D深度"}),(0,s.jsx)("input",{type:"range",min:"1",max:"20",step:"1",value:t.depth,onChange:e=>a({depth:parseInt(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.depth,"px"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"光源角度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"360",step:"1",value:t.lightAngle,onChange:e=>a({lightAngle:parseInt(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.lightAngle,"\xb0"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"高光颜色"}),(0,s.jsx)("input",{type:"color",value:t.highlightColor,onChange:e=>a({highlightColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"阴影颜色"}),(0,s.jsx)("input",{type:"color",value:t.shadowColor,onChange:e=>a({shadowColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),"image"===t.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"水印图片"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&a({imageFile:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"缩放比例"}),(0,s.jsx)("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:t.imageScale,onChange:e=>a({imageScale:parseFloat(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[Math.round(100*t.imageScale),"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"透明度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:t.imageOpacity,onChange:e=>a({imageOpacity:parseFloat(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[Math.round(100*t.imageOpacity),"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"旋转角度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"360",step:"1",value:t.imageRotation,onChange:e=>a({imageRotation:parseInt(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.imageRotation,"\xb0"]})]})]}),"pattern"===t.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"图案类型"}),(0,s.jsxs)("select",{value:t.patternType,onChange:e=>a({patternType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"circle",children:"圆形"}),(0,s.jsx)("option",{value:"square",children:"方形"}),(0,s.jsx)("option",{value:"triangle",children:"三角形"}),(0,s.jsx)("option",{value:"star",children:"星形"}),(0,s.jsx)("option",{value:"custom",children:"自定义"})]})]}),"custom"===t.patternType&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"SVG 路径"}),(0,s.jsx)("input",{type:"text",value:t.customPattern,onChange:e=>a({customPattern:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入 SVG 路径"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"颜色"}),(0,s.jsx)("input",{type:"color",value:t.patternColor,onChange:e=>a({patternColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"大小"}),(0,s.jsx)("input",{type:"range",min:"10",max:"100",step:"1",value:t.patternSize,onChange:e=>a({patternSize:parseInt(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.patternSize,"px"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"透明度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:t.patternOpacity,onChange:e=>a({patternOpacity:parseFloat(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[Math.round(100*t.patternOpacity),"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"旋转角度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"360",step:"1",value:t.patternRotation,onChange:e=>a({patternRotation:parseInt(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.patternRotation,"\xb0"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"间距"}),(0,s.jsx)("input",{type:"range",min:"20",max:"200",step:"10",value:t.patternSpacing,onChange:e=>a({patternSpacing:parseInt(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.patternSpacing,"px"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"透明度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"100",value:100*t.opacity,onChange:e=>i(Number(e.target.value)/100),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[Math.round(100*t.opacity),"%"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"旋转角度"}),(0,s.jsx)("input",{type:"range",min:"-180",max:"180",value:t.angle,onChange:e=>o(Number(e.target.value)),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[t.angle,"\xb0"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.tiled,onChange:e=>d(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"启用平铺"})]})}),t.tiled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"平铺间距"}),(0,s.jsx)("input",{type:"number",value:t.tileGap,onChange:e=>a({tileGap:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"平铺缩放"}),(0,s.jsx)("input",{type:"number",min:"0.1",max:"1",step:"0.1",value:t.tileScale,onChange:e=>a({tileScale:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),"security"===t.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"防伪码"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:t.securityCode,onChange:e=>m(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入防伪码"}),(0,s.jsx)("button",{onClick:()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));a({securityCode:t})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"随机生成"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"字体大小"}),(0,s.jsxs)("select",{value:t.securityCodeSize,onChange:e=>a({securityCodeSize:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"small",children:"小"}),(0,s.jsx)("option",{value:"medium",children:"中"}),(0,s.jsx)("option",{value:"large",children:"大"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"位置"}),(0,s.jsxs)("select",{value:t.securityCodePosition,onChange:e=>a({securityCodePosition:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"corners",children:"四角"}),(0,s.jsx)("option",{value:"center",children:"中心"}),(0,s.jsx)("option",{value:"random",children:"随机"})]})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.enableHiddenCode,onChange:e=>a({enableHiddenCode:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"启用隐藏防伪码"})]})}),t.enableHiddenCode&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"隐藏防伪码透明度"}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:t.hiddenCodeOpacity,onChange:e=>a({hiddenCodeOpacity:parseFloat(e.target.value)}),className:"w-full"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[Math.round(100*t.hiddenCodeOpacity),"%"]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"位置"}),(0,s.jsxs)("select",{value:t.position,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"top-left",children:"左上"}),(0,s.jsx)("option",{value:"top-right",children:"右上"}),(0,s.jsx)("option",{value:"bottom-left",children:"左下"}),(0,s.jsx)("option",{value:"bottom-right",children:"右下"}),(0,s.jsx)("option",{value:"center",children:"中心"})]})]})]})};var c=a(7635),o=a.n(c);let d=e=>{let{images:t,watermarkConfig:a,onDownloadComplete:r,isPreview:n=!1}=e,[i,c]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t.length>0?u():c([])},[t,a]);let u=async()=>{m(!0);let e=[];for(let a of t){let t=await x(a);e.push(t)}c(e),m(!1)},x=e=>new Promise(t=>{let s=new FileReader;s.onload=s=>{var l;let r=new Image;r.onload=()=>{let s=document.createElement("canvas"),l=s.getContext("2d");if(!l){t(URL.createObjectURL(e));return}s.width=r.width,s.height=r.height,l.drawImage(r,0,0),"text"===a.type?g(l,r):"image"===a.type&&a.imageFile?h(l,r.width,r.height):"security"===a.type&&p(l,r.width,r.height),s.toBlob(a=>{a?t(URL.createObjectURL(a)):t(URL.createObjectURL(e))},"image/jpeg",.9)},r.src=null===(l=s.target)||void 0===l?void 0:l.result},s.readAsDataURL(e)}),g=(e,t)=>{let{text:s,fontSize:l,color:r,opacity:n,position:i,angle:c,enable3D:o,depth:d,lightAngle:m,highlightColor:u,shadowColor:x}=a;e.font="".concat(l,"px Arial"),e.textAlign="center",e.textBaseline="middle";let{x:g,y:h}=y(e,t,i);if(e.save(),e.translate(g,h),e.rotate(c*Math.PI/180),e.globalAlpha=n,o){let t=Math.cos(m*Math.PI/180),a=Math.sin(m*Math.PI/180);for(let l=d;l>0;l--){let r=l*t,n=l*a;e.fillStyle=x,e.fillText(s,r,n)}e.fillStyle=r,e.fillText(s,0,0);let l=.2*d;e.fillStyle=u,e.fillText(s,-l*t,-l*a)}else e.fillStyle=r,e.fillText(s,0,0);e.restore()},h=(e,t,s)=>{if(!a.imageFile)return;let l=new Image;l.src=URL.createObjectURL(a.imageFile),e.save(),e.globalAlpha=a.imageOpacity;let r=t*a.imageScale,n=l.height/l.width*r,{x:i,y:c}=y(e,l,a.imagePosition);if(0!==a.imageRotation&&(e.translate(i,c),e.rotate(a.imageRotation*Math.PI/180),e.translate(-i,-c)),a.tiled){let i=t/a.tileGap,c=s/a.tileGap;for(let o=0;o<t;o+=i)for(let t=0;t<s;t+=c)e.drawImage(l,o,t,r*a.tileScale,n*a.tileScale)}else e.drawImage(l,i-r/2,c-n/2,r,n);e.restore()},p=(e,t,s)=>{a.securityCode&&(e.save(),e.font="".concat(b(),"px ").concat(a.securityFont),e.fillStyle="#000000",e.textAlign="center",e.textBaseline="middle",j(t,s).forEach(t=>{let{x:s,y:l}=t;e.fillText(a.securityCode,s,l)}),a.enableHiddenCode&&(e.globalAlpha=a.hiddenCodeOpacity,f(t,s,5).forEach(t=>{let{x:s,y:l}=t;e.fillText(a.securityCode,s,l)})),e.restore())},y=(e,t,a)=>{switch(a){case"top-left":return{x:.25*t.width,y:.25*t.height};case"top-right":return{x:.75*t.width,y:.25*t.height};case"bottom-left":return{x:.25*t.width,y:.75*t.height};case"bottom-right":return{x:.75*t.width,y:.75*t.height};default:return{x:t.width/2,y:t.height/2}}},b=()=>{switch(a.securityCodeSize){case"small":return 12;case"large":return 24;default:return 16}},j=(e,t)=>{let s=[];switch(a.securityCodePosition){case"corners":s.push({x:50,y:50},{x:e-50,y:50},{x:50,y:t-50},{x:e-50,y:t-50});break;case"center":s.push({x:e/2,y:t/2});break;case"random":s.push(...f(e,t,4))}return s},f=(e,t,a)=>{let s=[];for(let l=0;l<a;l++)s.push({x:100+Math.random()*(e-200),y:100+Math.random()*(t-200)});return s},v=async()=>{if(d||0===i.length)return;let e=new(o()),t=e.folder("watermarked_images");for(let e=0;e<i.length;e++){let a=await fetch(i[e]),s=await a.blob();null==t||t.file("watermarked_".concat(e+1,".jpg"),s)}let a=await e.generateAsync({type:"blob"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="watermarked_images.zip",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s),null==r||r(i)};return 0===t.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border border-gray-200",children:(0,s.jsx)("p",{className:"text-gray-500",children:"请上传图片"})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:i.map((e,t)=>(0,s.jsx)("div",{className:"relative aspect-video",children:(0,s.jsx)("img",{src:e,alt:"Processed ".concat(t+1),className:"w-full h-full object-contain rounded-lg border border-gray-200"})},t))}),!n&&(0,s.jsx)("button",{onClick:v,disabled:d||0===i.length,className:"w-full py-2 px-4 rounded-lg font-medium transition-colors ".concat(d||0===i.length?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:d?"处理中...":"下载全部"})]})},m=e=>{let{isOpen:t,onClose:a}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4 relative",children:[(0,s.jsx)("button",{onClick:a,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"联系作者"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-2",children:"扫描下方二维码添加作者微信"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("img",{src:"/qrcode.jpg",alt:"作者微信二维码",className:"w-48 h-48 object-cover border-4 border-white shadow-lg rounded-lg"})})]}),(0,s.jsxs)("div",{className:"text-left space-y-2 bg-blue-50 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-blue-800",children:"其他联系方式："}),(0,s.jsxs)("p",{className:"text-blue-600",children:[(0,s.jsx)("span",{className:"font-medium",children:"邮箱："}),(0,s.jsx)("a",{href:"mailto:your@email.com",className:"hover:underline",children:"yangweishuo297@gmail.com"})]}),(0,s.jsxs)("p",{className:"text-blue-600",children:[(0,s.jsx)("span",{className:"font-medium",children:"微信号："}),(0,s.jsx)("span",{className:"select-all",children:"muyiredbook"})]})]}),(0,s.jsx)("div",{className:"bg-yellow-50 rounded-lg p-4 text-left",children:(0,s.jsxs)("p",{className:"text-yellow-800 text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"提示："}),'添加微信时请注明"水印工具"，方便及时通过。']})})]})]})]})}):null},u="watermark_usage_count",x=()=>{let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)(0),[c,o]=(0,l.useState)(!1),[x,g]=(0,l.useState)("text"),[h,p]=(0,l.useState)({text:"水印文字",fontSize:24,color:"#000000",opacity:.5,position:"center",angle:0,tiled:!1,tileGap:100,tileScale:1,type:"text",enable3D:!1,depth:5,lightAngle:45,highlightColor:"#ffffff",shadowColor:"#000000",securityCode:"",securityCodeSize:"medium",securityFont:"Arial",securityCodePosition:"corners",enableHiddenCode:!1,hiddenCodeOpacity:.1,imageScale:.2,imageOpacity:.5,imagePosition:"center",imageRotation:0,patternType:"circle",patternColor:"#000000",patternSize:20,patternOpacity:.5,patternRotation:0,patternSpacing:50,customPattern:""});(0,l.useEffect)(()=>{let e=localStorage.getItem(u);r(e?parseInt(e):0)},[]);let y=()=>{let e=a+1;r(e),localStorage.setItem(u,e.toString())},b=async e=>{if(a>=5){o(!0);return}(!(await Promise.all(e.map(f))).some(e=>e)||window.confirm("检测到部分图片可能已经包含水印，是否继续添加？"))&&t(e)},j=e=>{t(t=>t.filter((t,a)=>a!==e))},f=async e=>new Promise(t=>{let a=new Image,s=new FileReader;s.onload=e=>{var s;a.src=null===(s=e.target)||void 0===s?void 0:s.result,a.onload=()=>{let e=document.createElement("canvas"),s=e.getContext("2d");if(!s){t(!1);return}e.width=a.width,e.height=a.height,s.drawImage(a,0,0);let l=s.getImageData(0,0,e.width,e.height).data,r=!1,n=!1,i=0,c={};for(let t=0;t<l.length;t+=4)if(l[t+3]<255&&l[t+3]>0&&(r=!0),t%(80*e.width)==0){let e="".concat(l[t],",").concat(l[t+1],",").concat(l[t+2]);c[e]=(c[e]||0)+1,c[e]>10&&(n=!0),i++}t(r||n&&i>100)}},s.readAsDataURL(e)});return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>g("text"),className:"px-6 py-2 rounded-lg font-medium transition-colors ".concat("text"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"文字水印"}),(0,s.jsx)("button",{onClick:()=>g("image"),className:"px-6 py-2 rounded-lg font-medium transition-colors ".concat("image"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"图片水印"}),(0,s.jsx)("button",{onClick:()=>g("pattern"),className:"px-6 py-2 rounded-lg font-medium transition-colors ".concat("pattern"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"图案水印"}),(0,s.jsx)("button",{onClick:()=>g("security"),className:"px-6 py-2 rounded-lg font-medium transition-colors ".concat("security"===x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"防伪水印"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{className:"space-y-6 bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"上传图片"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"px-3 py-1 bg-blue-50 rounded-full",children:(0,s.jsxs)("span",{className:"text-sm text-blue-600 font-medium",children:["剩余次数：",(0,s.jsx)("span",{className:"text-blue-700",children:Math.max(0,5-a)}),"/",5]})}),e.length>0&&(0,s.jsx)("button",{onClick:()=>{e.length>0&&window.confirm("确定要清空所有已上传的图片吗？")&&t([])},className:"text-sm text-red-600 hover:text-red-700 transition-colors",children:"清空图片"})]})]}),a>=5&&(0,s.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 rounded-lg p-3 flex justify-between items-center",children:[(0,s.jsx)("span",{children:"您的免费使用次数已用完！"}),(0,s.jsx)("button",{onClick:()=>o(!0),className:"px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"联系作者"})]})]}),(0,s.jsx)(n,{onUpload:b}),e.length>0&&(0,s.jsxs)("div",{className:"border-t border-gray-100 pt-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"已上传图片"}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[e.length," 张图片"]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:e.map((e,t)=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"aspect-video rounded-lg border border-gray-200 overflow-hidden",children:(0,s.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-full object-cover"})}),(0,s.jsx)("button",{onClick:()=>j(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("div",{className:"mt-1 text-xs text-gray-500 truncate",children:e.name})]},t))})]}),(0,s.jsxs)("div",{className:"border-t border-gray-100 pt-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"text"===x?"水印设置":"image"===x?"图片水印设置":"pattern"===x?"图案水印设置":"防伪设置"}),(0,s.jsx)(i,{config:{...h,type:x},onChange:e=>{p(t=>({...t,...e}))}})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"实时预览"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(d,{images:e,watermarkConfig:{...h,type:x},onDownloadComplete:()=>{y(),a>=4&&o(!0)},isPreview:!0})})]})]}),(0,s.jsx)(m,{isOpen:c,onClose:()=>o(!1)})]})}}},function(e){e.O(0,[835,971,117,744],function(){return e(e.s=7574)}),_N_E=e.O()}]);