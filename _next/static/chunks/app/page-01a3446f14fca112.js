(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7663:function(e,t,s){Promise.resolve().then(s.bind(s,4846))},4846:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});var i=s(3827),r=s(4090),l=e=>{let{config:t,onChange:s,usageCount:r,maxUsageCount:l}=e,a=(e,i)=>{s&&s({...t,[e]:i})};return(0,i.jsxs)("div",{className:"space-y-6 p-4 bg-white rounded-lg shadow",children:[(0,i.jsxs)("div",{className:"border-b pb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"文字水印"}),(0,i.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"text",className:"block text-sm font-medium text-gray-700",children:"水印文字"}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)("input",{type:"text",id:"text",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",value:t.text||"",onChange:e=>a("text",e.target.value),placeholder:"输入水印文字"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"fontSize",className:"block text-sm font-medium text-gray-700",children:"字体大小"}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("input",{type:"range",id:"fontSize",min:"10",max:"100",className:"w-full",value:t.fontSize,onChange:e=>a("fontSize",parseInt(e.target.value))}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[t.fontSize,"px"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"color",className:"block text-sm font-medium text-gray-700",children:"颜色"}),(0,i.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,i.jsx)("input",{type:"color",id:"color",className:"h-8 w-8 rounded-md border border-gray-300",value:t.color,onChange:e=>a("color",e.target.value)}),(0,i.jsx)("input",{type:"text",className:"ml-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block sm:text-sm border-gray-300 rounded-md",value:t.color,onChange:e=>a("color",e.target.value)})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"opacity",className:"block text-sm font-medium text-gray-700",children:"透明度"}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("input",{type:"range",id:"opacity",min:"1",max:"100",className:"w-full",value:t.opacity,onChange:e=>a("opacity",parseInt(e.target.value))}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[t.opacity,"%"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"position",className:"block text-sm font-medium text-gray-700",children:"位置"}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsxs)("select",{id:"position",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",value:t.position,onChange:e=>a("position",e.target.value),children:[(0,i.jsx)("option",{value:"center",children:"居中"}),(0,i.jsx)("option",{value:"top-left",children:"左上角"}),(0,i.jsx)("option",{value:"top-right",children:"右上角"}),(0,i.jsx)("option",{value:"bottom-left",children:"左下角"}),(0,i.jsx)("option",{value:"bottom-right",children:"右下角"})]})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"rotation",className:"block text-sm font-medium text-gray-700",children:"旋转角度"}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("input",{type:"range",id:"rotation",min:"0",max:"360",className:"w-full",value:t.rotation,onChange:e=>a("rotation",parseInt(e.target.value))}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[t.rotation,"\xb0"]})]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("label",{htmlFor:"tiled",className:"block text-sm font-medium text-gray-700",children:"平铺水印"}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)("input",{type:"checkbox",id:"tiled",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:t.tiled,onChange:e=>a("tiled",e.target.checked)})})]}),t.tiled&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"spacing",className:"block text-sm font-medium text-gray-700",children:"间距"}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("input",{type:"range",id:"spacing",min:"50",max:"400",className:"w-full",value:t.spacing,onChange:e=>a("spacing",parseInt(e.target.value))}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[t.spacing,"px"]})]})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"防伪水印"}),(0,i.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("button",{type:"button",onClick:()=>{let e=Math.random().toString(36).substring(2,8).toUpperCase();a("text","".concat(t.text||"").concat(e))},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:"number"==typeof r&&"number"==typeof l&&r>=l,children:["添加随机防伪码","number"==typeof r&&"number"==typeof l&&(0,i.jsxs)("span",{className:"ml-2 text-xs",children:["(",r,"/",l,")"]})]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"securityCodeSize",className:"block text-sm font-medium text-gray-700",children:"防伪码大小"}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("input",{type:"range",id:"securityCodeSize",min:"10",max:"100",className:"w-full",value:t.securityCodeSize,onChange:e=>a("securityCodeSize",parseInt(e.target.value))}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[t.securityCodeSize,"px"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"securityCodePosition",className:"block text-sm font-medium text-gray-700",children:"防伪码位置"}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsxs)("select",{id:"securityCodePosition",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",value:t.securityCodePosition,onChange:e=>a("securityCodePosition",e.target.value),children:[(0,i.jsx)("option",{value:"tiled",children:"平铺"}),(0,i.jsx)("option",{value:"diagonal",children:"对角线"}),(0,i.jsx)("option",{value:"border",children:"边框"})]})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"securityFont",className:"block text-sm font-medium text-gray-700",children:"防伪字体"}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsxs)("select",{id:"securityFont",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",value:t.securityFont||"Arial",onChange:e=>a("securityFont",e.target.value),children:[(0,i.jsx)("option",{value:"Arial",children:"Arial"}),(0,i.jsx)("option",{value:"Times New Roman",children:"Times New Roman"}),(0,i.jsx)("option",{value:"Courier New",children:"Courier New"}),(0,i.jsx)("option",{value:"Georgia",children:"Georgia"}),(0,i.jsx)("option",{value:"Verdana",children:"Verdana"})]})})]})]})]}),"number"==typeof r&&"number"==typeof l&&r>=0&&l>0&&(0,i.jsxs)("div",{className:"usage-count",children:["剩余使用次数: ",l-r," / ",l]})]})};let a=e=>{let{images:t,config:s,onDownload:l,onDeleteImage:a}=e,[o,n]=(0,r.useState)([]),[d,c]=(0,r.useState)(0),[m,x]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{t.length>0&&g()},[t,s]);let g=async()=>{x(!0),h(null);try{let e=await Promise.all(t.map(f));n(e)}catch(e){h(e instanceof Error?e.message:"处理图片时出错")}x(!1)},f=async e=>new Promise((t,i)=>{let r=new FileReader;r.onload=e=>{var r;let l=new Image;l.onload=()=>{let e=document.createElement("canvas"),r=e.getContext("2d");if(!r){i(Error("无法获取画布上下文"));return}e.width=l.width,e.height=l.height,r.drawImage(l,0,0),v(r,e.width,e.height,s),t(e.toDataURL("image/jpeg"))},l.onerror=()=>i(Error("图片加载失败")),l.src=null===(r=e.target)||void 0===r?void 0:r.result},r.onerror=()=>i(Error("文件读取失败")),r.readAsDataURL(e)}),v=(e,t,s,i)=>{e.save(),e.globalAlpha=i.opacity/100,j(e,t,s,i),i.securityCode&&p(e,t,s,i),e.restore()},j=(e,t,s,i)=>{if(e.font="".concat(i.fontSize,"px ").concat(i.securityFont||"Arial"),e.fillStyle=i.color,e.textAlign="center",e.textBaseline="middle",i.tiled){let r=i.spacing||100;for(let l=r;l<t;l+=r)for(let t=r;t<s;t+=r)e.save(),e.translate(l,t),e.rotate(i.rotation*Math.PI/180),e.fillText(i.text,0,0),e.restore()}else{let r=y(t,s,i.position);e.save(),e.translate(r.x,r.y),e.rotate(i.rotation*Math.PI/180),e.fillText(i.text,0,0),e.restore()}},p=(e,t,s,i)=>{if(!i.securityCode)return;let r="string"==typeof i.text?i.text:"安全水印";if(e.font="".concat(i.securityCodeSize,"px Arial"),e.fillStyle=i.color,e.textAlign="center",e.textBaseline="middle","tiled"===i.securityCodePosition)for(let l=150;l<t;l+=150)for(let t=150;t<s;t+=150)e.save(),e.translate(l,t),e.rotate(i.rotation*Math.PI/180),e.fillText(r,0,0),e.restore();else"diagonal"===i.securityCodePosition?(e.save(),e.translate(.25*t,.25*s),e.rotate(i.rotation*Math.PI/180),e.fillText(r,0,0),e.restore(),e.save(),e.translate(.75*t,.75*s),e.rotate(i.rotation*Math.PI/180),e.fillText(r,0,0),e.restore()):"border"===i.securityCodePosition&&[{x:.2*t,y:.1*s},{x:.8*t,y:.1*s},{x:.2*t,y:.9*s},{x:.8*t,y:.9*s}].forEach(t=>{e.save(),e.translate(t.x,t.y),e.rotate(i.rotation*Math.PI/180),e.fillText(r,0,0),e.restore()})},y=(e,t,s)=>{switch(s){case"top-left":return{x:.1*e,y:.1*t};case"top-right":return{x:.9*e,y:.1*t};case"bottom-left":return{x:.1*e,y:.9*t};case"bottom-right":return{x:.9*e,y:.9*t};default:return{x:.5*e,y:.5*t}}};return m?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-64",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"}),(0,i.jsx)("p",{className:"mt-4 text-sm text-gray-500",children:"处理中..."})]}):u?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-64",children:[(0,i.jsx)("svg",{className:"w-12 h-12 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,i.jsx)("p",{className:"mt-4 text-sm text-red-500",children:u})]}):(0,i.jsx)("div",{className:"space-y-4",children:o.length>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("img",{src:o[d],alt:"预览",className:"w-full h-auto rounded-lg shadow-lg"}),(0,i.jsx)("button",{onClick:()=>a(d),className:"absolute top-2 right-2 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:(0,i.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsxs)("button",{onClick:()=>{o[d]&&l&&l(o[d])},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"下载图片"]})})]})})},o=()=>{let[e,t]=(0,r.useState)({text:"",fontSize:20,color:"#000000",opacity:50,position:"center",rotation:0,tiled:!1,spacing:50,imageUrl:"",size:100,securityFont:"Arial"}),[s,o]=(0,r.useState)(null),n=(0,r.useRef)(null);return(0,i.jsxs)("div",{className:"divide-y divide-gray-200",children:[(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h2",{className:"text-2xl font-semibold text-gray-900",children:"图片水印工具"}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsx)("input",{type:"file",ref:n,onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&o(s)},accept:"image/*",className:"hidden"}),(0,i.jsx)("button",{onClick:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"选择图片"})]})]})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-gray-200",children:[(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)(l,{config:e,onChange:e=>{t(t=>({...t,...e}))}})}),(0,i.jsx)("div",{className:"p-6",children:s?(0,i.jsx)(a,{images:[s],config:e,onDownload:e=>{let t=document.createElement("a");t.href=e,t.download="watermarked-image.jpg",t.click()},onDeleteImage:e=>{o(null)}}):(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,i.jsx)("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,i.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"请选择一张图片"})]})})]})]})};function n(){return(0,i.jsx)("main",{className:"min-h-screen py-12 px-4 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,i.jsxs)("div",{className:"text-center mb-12",children:[(0,i.jsx)("h1",{className:"text-4xl font-bold text-gray-900 sm:text-5xl md:text-6xl",children:"图片水印工具"}),(0,i.jsx)("p",{className:"mt-4 text-xl text-gray-600",children:"轻松为您的图片添加自定义水印"})]}),(0,i.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:(0,i.jsx)(o,{})})]})})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=7663)}),_N_E=e.O()}]);